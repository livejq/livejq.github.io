function init(e){var t=$(".leancloud_visitors").attr("data-url").trim()||$(".leancloud_likes").attr("data-url").trim(),o=$(".leancloud_visitors").attr("data-title").trim()||$(".leancloud_likes").attr("data-title").trim(),i=new AV.Query(e);i.equalTo("url",t),i.find().then((function(i){if(i.length>0)console.log("Object instance already exists.");else{var n=new e;n.set("url",t),n.set("title",o),n.set("visitors",0),n.set("likes",0),n.save().then((function(e){console.log("Succed to create."),console.log("New object created with objectId: "+e.id)}),(function(e){console.log("Failed to create!"),console.error("Failed to create new object, with error message: "+e.message)}))}}),(function(e){console.log("Error:"+e.code+" "+e.message)}))}function addVisitors(e){var t=$(".leancloud_visitors").attr("data-url").trim(),o=($(".leancloud_visitors").attr("data-title").trim(),$(".leancloud_visitors_count").attr("id").trim()),i=new AV.Query(e);i.equalTo("url",t),i.find().then((function(e){if(e.length>0){var t=e[0];t.increment("visitors"),t.fetchWhenSave(!0),t.save().then((function(e){var t=e.get("visitors");$(document.getElementById(o)).text(t),console.log("Succed to add visitors."),console.log("New visitors: "+e.id+" "+e.get("url")+" "+e.get("visitors"))}),(function(e){console.log("Failed to add visitors!"),console.log("Error:"+e.code+" "+e.message)}))}}),(function(e){console.log("Error:"+e.code+" "+e.message)}))}function addLikes(e){var t=$(".leancloud_likes").attr("data-url").trim(),o=($(".leancloud_likes").attr("data-title").trim(),$(".leancloud_likes_count").attr("id").trim()),i=new AV.Query(e);i.equalTo("url",t),i.find().then((function(e){if(e.length>0){var t=e[0];t.increment("likes"),t.fetchWhenSave(!0),t.save().then((function(e){var t=e.get("likes");$(document.getElementById(o)).text(t),console.log("Succed to add likes."),console.log("New likes: "+e.id+" "+e.get("url")+" "+e.get("likes"))}),(function(e){console.log("Failed to add likes!"),console.log("Error:"+e.code+" "+e.message)}))}}),(function(e){console.log("Error:"+e.code+" "+e.message)}))}function showVisitors(e){var t=new AV.Query(e),o=[];$(".leancloud_visitors").each((function(){o.push($(this).attr("data-url").trim())})),t.containedIn("url",o),t.find().then((function(e){if(0!==e.length){for(var t=0;t<e.length;t++){var i=e[t],n=i.get("url"),l=i.get("visitors"),s=document.getElementById(n+"_visitors");$(s).find(".leancloud_visitors_count").text(l)}for(t=0;t<o.length;t++){n=o[t],s=document.getElementById(n+"_visitors");""==$(s).find(".leancloud_visitors_count").text()&&$(s).find(".leancloud_visitors_count").text(0)}}else $(".leancloud_visitors").find(".leancloud_visitors_count").text(0)}),(function(e){console.log("Error: "+e.code+" "+e.message)}))}function showLikes(e){var t=new AV.Query(e),o=[];$(".leancloud_likes").each((function(){o.push($(this).attr("data-url").trim())})),t.containedIn("url",o),t.find().then((function(e){if(0!==e.length){for(var t=0;t<e.length;t++){var i=e[t],n=i.get("url"),l=i.get("likes"),s=document.getElementById(n+"_likes");$(s).find(".leancloud_likes_count").text(l)}for(t=0;t<o.length;t++){n=o[t],s=document.getElementById(n+"_likes");""==$(s).find(".leancloud_likes_count").text()&&$(s).find(".leancloud_likes_count").text(0)}}else $(".leancloud_likes").find(".leancloud_likes_count").text(0)}),(function(e){console.log("Error: "+e.code+" "+e.message)}))}function topNPost(e,t){var o=new AV.Query("Counter");o.notEqualTo("id",0),o.descending("visitors"),o.limit(t),o.find().then((function(e){for(var o=0;o<t;o++){var i=e[o],n="<ul class='topN-post-list'><li class='topN-post-item'><a class='item-title' href='"+i.get("url")+"'>"+i.get("title")+"</a><i class='item-visitors'>【文章热度:"+i.get("visitors")+"℃】</i></li></ul>";document.getElementById("topN").innerHTML+=n}console.log("Succed to find topNPost.")}),(function(e){console.log("Error: "+e.code+" "+e.message)}))}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){var n=o[i].trim();if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}function getCookieById(e,t){for(var o=e+"=",i=document.cookie.split(";"),n="",l=0;l<i.length;l++){0==(r=i[l].trim()).indexOf(o)&&(n=r.substring(o.length,r.length))}if(""!=n){var s=n.split(",");for(l=0;l<s.length;l++){var r;if(0==(r=s[l].trim()).indexOf(t))return!0}}return""}function addCookieById(e,t,o){var i=getCookie(e);if(""==i)i=t;else{for(var n=i.split(","),l=0,s=0;s<n.length;s++){if(0==n[s].trim().indexOf(t)){l=1;break}}0==l&&(i+=","+t)}var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3);var a="expires="+r.toGMTString();document.cookie=e+"="+i+"; "+a}function AnnieLeancloud(e,t){AV.initialize(e,t);var o=AV.Object.extend("Counter");return $(".layout-post").length?function(){if(init(o),1==$(".leancloud_visitors").length&&addVisitors(o),$(".leancloud_likes").length){var e=$(".leancloud_likes").attr("data-url").trim(),t=getCookieById("star",e);""!=t&&$(".leancloud_likes").addClass("heartAnimation"),showLikes(o),$(".layout-post").on("click",".leancloud_likes",(function(){"unlike"===$(this).attr("rel")&&""==t&&(addLikes(o),$(this).addClass("heartAnimation").attr("rel","like"),addCookieById("star",e,.25))}))}}():($(".layout-pure").length||$(".layout-cart").length)&&$(".post-title").length>=1?($(".leancloud_visitors").length&&showVisitors(o),void($(".leancloud_likes").length&&showLikes(o))):void 0}